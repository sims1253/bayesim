<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulation Framework for Bayesian Modeling • bayesim</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Simulation Framework for Bayesian Modeling">
<meta name="description" content="A comprehensive simulation framework for Bayesian modeling studies. Provides tools for running complex simulation studies with brms models, including parallel processing, comprehensive metrics calculation, and advanced analyses like Simulation-Based Calibration (SBC). Supports custom data generation processes and extensible metric systems.">
<meta property="og:description" content="A comprehensive simulation framework for Bayesian modeling studies. Provides tools for running complex simulation studies with brms models, including parallel processing, comprehensive metrics calculation, and advanced analyses like Simulation-Based Calibration (SBC). Supports custom data generation processes and extensible metric systems.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">bayesim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.34.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="bayesim">Bayesim<a class="anchor" aria-label="anchor" href="#bayesim"></a>
</h1></div>
<p><a href="LICENSE"><img src="https://img.shields.io/badge/License-GPL%20v3-blue.svg" alt="License: GPL v3"></a> <a href="https://github.com/sims1253/bayesim/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/sims1253/bayesim/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a> <a href="https://github.com/sims1253/bayesim/actions/workflows/test-coverage.yaml" class="external-link"><img src="https://github.com/sims1253/bayesim/actions/workflows/test-coverage.yaml/badge.svg" alt="Tests"></a> <a href="https://app.codecov.io/gh/sims1253/bayesim" class="external-link"><img src="https://codecov.io/gh/sims1253/bayesim/graph/badge.svg" alt="Codecov test coverage"></a> <a href="https://github.com/sims1253/bayesim/actions/workflows/pkgdown.yaml" class="external-link"><img src="https://github.com/sims1253/bayesim/actions/workflows/pkgdown.yaml/badge.svg" alt="GH-Pages"></a> <a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></p>
<p>A simulation framework for Bayesian models based on <a href="https://github.com/paul-buerkner/brms/" class="external-link">brms</a>.</p>
<p>The main function is <code>full_simulation</code> with the main arguments being <code>data_gen_confs</code>, <code>data_gen_fun</code>, <code>fit_confs</code> and <code>metrics</code>. Bayesim will generate datasets by passing <code>data_gen_confs</code> rows to <code>data_gen_fun</code> and fit each model defined by <code>fit_confs</code> on each generated dataset. It then calculates all of the defined <code>metrics</code> for each model. This is, as of now, done in a fully crossed fashion.</p>
<div class="section level2">
<h2 id="define-data-simulation">Define Data Simulation<a class="anchor" aria-label="anchor" href="#define-data-simulation"></a>
</h2>
<p>Data simulation consists of two parts. A <code>data_gen_fun</code> function and a <code>data_gen_confs</code> dataframe. Bayesim will feed each row of <code>data_gen_confs</code> into <code>data_gen_fun</code> to generate each individual dataset.</p>
<p>The only strictly necessary columns in <code>data_gen_confs</code> are:</p>
<ul>
<li><p><code>dataset_N</code>, the number of datasets that should be simulated per configuration. This is what Bayesim parallelize over.</p></li>
<li><p><code>id</code>, a unique identifier string that is used to save the results per configuration row.</p></li>
<li><p><code>vars_of_interest</code>, if you want metrics calculated for individual parameters. It should be a list of variable names used in <code>data_gen_fun</code>.</p></li>
</ul>
<p><code>data_gen_fun</code> should output a named list that contains the following parts:</p>
<ul>
<li><p><code>dataset</code>, a dataframe that is fed into <code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm</a></code></p></li>
<li><p><code>testing_data</code>, a dataframe that is used as <code>newdata</code> argument for certain out-of-sample metrics.</p></li>
<li><p><code>data_gen_output</code>, a named list that contains all other information that you want to export from the data generating function. This should usually include all the input arguments (see example for how to get those easily), and a <code>references</code> list, that contains the reference values for all <code>vars_of_interest</code> variables (again, see the example for how to easily get those). An example is presented below:</p></li>
</ul>
<p>```{r} constant_linpred_dgp &lt;- function(data_N, data_link, data_family, seed = NULL, testing_data = TRUE, vars_of_interest = list(“mu”), mean = 0, …) { arguments &lt;- as.list(c(as.list(environment()), list(…))) arguments$seed &lt;- NULL</p>
<p>if (!is.null(seed)) { set.seed(seed) }</p>
<p>if (testing_data) { data_gen_size &lt;- data_N * 2 } else { data_gen_size &lt;- data_N } dataset &lt;- data.frame() mu = rnorm(n = 1, mean = x, sd = 1) y = rnorm(n = data_gen_size, mean = mu, sd = 1)</p>
<p># This creates a list of values for each of the vars_of_interest. arguments$references &lt;- lapply( unlist(vars_of_interest), function(x) get(x) )</p>
<p>data_gen_output &lt;- list() # Anything in addition to the function arguments you want to save about # the data generation process ie. If you are resampling the number # of invalid samples. ) data_gen_output &lt;- c(data_gen_output, arguments)</p>
<p>if (testing_data) { return( list( dataset = list(y = dataset[1:data_N, ]), testing_data = list(y = dataset[(data_N + 1):data_gen_size, ]), data_gen_output = data_gen_output ) ) } else { return( list( dataset = dataset, testing_data = NULL, data_gen_output = data_gen_output ) ) } }</p>
<p>```</p>
</div>
<div class="section level2">
<h2 id="define-fit-configurations">Define Fit Configurations<a class="anchor" aria-label="anchor" href="#define-fit-configurations"></a>
</h2>
<p>Fit configurations currently are dataframes with the following columns:</p>
<ul>
<li><p><code>fit_family</code>, see <a href="R/ll_lookup.R#L10">brms_family_lookup</a> for supported families.</p></li>
<li><p><code>fit_link</code>, see <a href="R/ll_lookup.R#L70">link_lookup</a> for supported families.</p></li>
<li><p><code>formula</code>, a string that allows conversion via <code><a href="https://paulbuerkner.com/brms/reference/brmsformula.html" class="external-link">brms::brmsformula</a></code></p></li>
<li><p><code>prior</code>, gets passed to <code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm</a></code> directly.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="define-metrics">Define Metrics<a class="anchor" aria-label="anchor" href="#define-metrics"></a>
</h2>
<p>Metrics are defined via a list of string identifiers. The supported metrics are:</p>
<div class="section level3">
<h3 id="variable-summaries">Variable summaries<a class="anchor" aria-label="anchor" href="#variable-summaries"></a>
</h3>
<p><code>"v_mean"</code> <code>"v_sd"</code> <code>"v_median"</code> <code>"v_mad"</code> <code>"v_pos_prob"</code> <code>"v_quantiles"</code> <code>"v_bias"</code> <code>"v_rmse"</code> <code>"v_mae"</code> <code>"v_mse"</code> <code>"v_true_percentile"</code></p>
</div>
<div class="section level3">
<h3 id="global-mcmc-diagnostics">Global MCMC Diagnostics<a class="anchor" aria-label="anchor" href="#global-mcmc-diagnostics"></a>
</h3>
<p><code>"divergent_transitions_rel"</code> <code>"divergent_transitions_abs"</code> <code>"rstar"</code> <code>"bad_pareto_ks"</code> <code>"pareto_k_values"</code> <code>"time_per_sample"</code></p>
</div>
<div class="section level3">
<h3 id="variable-mcmc-diagnostics">Variable MCMC Diagnostics<a class="anchor" aria-label="anchor" href="#variable-mcmc-diagnostics"></a>
</h3>
<p><code>"rhat"</code> <code>"ess_bulk"</code> <code>"ess_tail"</code></p>
</div>
<div class="section level3">
<h3 id="predictive-metrics">Predictive Metrics<a class="anchor" aria-label="anchor" href="#predictive-metrics"></a>
</h3>
<p><code>"elpd_loo"</code> <code>"elpd_loo_pointwise"</code> <code>"elpd_loo_pointwise_summary"</code> <code>"elpd_test"</code> <code>"elpd_test_pointwise_summary"</code> <code>"rmse_loo"</code> <code>"rmse_loo_pointwise"</code> <code>"rmse_loo_pointwise_summary"</code> <code>"rmse_test"</code> <code>"rmse_test_pointwise_summary"</code> <code>"r2_loo"</code> <code>"r2_loo_pointwise"</code> <code>"r2_loo_pointwise_summary"</code> <code>"r2_test"</code> <code>"r2_test_pointwise_summary"</code></p>
</div>
<div class="section level3">
<h3 id="posterior-sample-based-metrics">Posterior sample based metrics<a class="anchor" aria-label="anchor" href="#posterior-sample-based-metrics"></a>
</h3>
<p><code>"log_lik_pointwise"</code> <code>"log_lik_summary"</code> <code>"ppred_summary_y_scaled"</code> <code>"ppred_pointwise"</code> <code>"residuals"</code> <code>"posterior_linpred"</code> <code>"posterior_linpred_transformed"</code></p>
</div>
<div class="section level3">
<h3 id="observations">Observations<a class="anchor" aria-label="anchor" href="#observations"></a>
</h3>
<p><code>"y_pointwise"</code> <code>"y_pointwise_z_scaled"</code> <code>"y_summaries"</code></p>
</div>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p><code>"data_gen"</code></p>
</div>
<div class="section level3">
<h3 id="fits">Fits<a class="anchor" aria-label="anchor" href="#fits"></a>
</h3>
<p><code>"fit_gen"</code></p>
<p>Or see <a href="R/metric_lookup.R#L11">metric_lookup</a> for all currently implemented metrics.</p>
</div>
</div>
<div class="section level2">
<h2 id="additional-arguments">Additional Arguments<a class="anchor" aria-label="anchor" href="#additional-arguments"></a>
</h2>
<p><code>seed</code>, sets a seed that will result in the rest of the simulation happening deterministically, conditional on the seed. Allows for reproduction of individual results or the entire simulation run later on.</p>
<div class="section level3">
<h3 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h3>
<ul>
<li><p><code>result_path = "./"</code>, The path where the result .RDS files should be saved.</p></li>
<li><p><code>debug = FALSE</code>, <code>TRUE</code> will save all intermediate results as .RDS files in the <code>result_path</code> directory to support debugging.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="stan-options">Stan Options<a class="anchor" aria-label="anchor" href="#stan-options"></a>
</h3>
<p><code>stan_pars</code> should be a named list that contains the following arguments:</p>
<ul>
<li><p><code>warmup</code>, directly passed to <code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm</a></code></p></li>
<li><p><code>iter</code>, directly passed to <code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm</a></code></p></li>
<li><p><code>chains</code>, directly passed to <code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm</a></code></p></li>
<li><p><code>init</code>, directly passed to <code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm</a></code></p></li>
<li><p><code>backend = "rstan"</code>, directly passed to <code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm</a></code> We recommend rstan due to instabilities of cmdstanr on clusters.</p></li>
<li><p><code>cmdstan_path</code>, useful when working with cmdstan on a computing cluster where cmdstan might not be installed in the default location. Use the path to the main directory, eg <code>"~/.cmdstan/cmdstan-2.29.2"</code>.</p></li>
<li><p><code>cmdstan_write_path</code>, directory for cmdstan to write compiled model files to. This should not be a temporary directory as those might get cleaned up during the simulation run.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="using-multiple-cores">Using multiple Cores<a class="anchor" aria-label="anchor" href="#using-multiple-cores"></a>
</h3>
<ul>
<li><p><code>ncores_simulation = 1</code>, If set to more than <code>1</code>, Bayesim will parallelize across datasets within each row of <code>data_gen_confs</code> using the specified number of processes.</p></li>
<li><p><code>cluster_type = "PSOCK"</code>, Defines the type of cluster used by the <code>parallel</code> package. Windows requires <code>PSOCK</code> however ’FORK` can save quite some time due to the repeated cluster setup times.</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="related-work">Related Work<a class="anchor" aria-label="anchor" href="#related-work"></a>
</h2>
<p>Bayesim has been used in the following projects:</p>
<ul>
<li>
<a href="https://arxiv.org/abs/2210.06927" class="external-link">Prediction can be safely used as a proxy for explanation in causally consistent Bayesian generalized linear models</a> <a href="https://zenodo.org/badge/latestdoi/453991253" class="external-link"><img src="https://zenodo.org/badge/453991253.svg" alt="DOI"></a>
</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing bayesim</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Maximilian Scholz <br><small class="roles"> Author, maintainer </small>   </li>
<li>Paul-Christian Bürkner <br><small class="roles"> Author </small>   </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Maximilian Scholz, Paul-Christian Bürkner.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
